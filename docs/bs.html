<!DOCTYPE html>

<!--
https://jbachnp.github.io/AhNull/bs.html
http://localhost:8081/AhNull/bs.html
-->

<html>
<head>
    <title>Dictation</title>
    <link rel="icon" href="SharedTechnology/MultimediaResource/Graphics/favicon3.ico?v=0">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--<link rel="manifest" href="manifest.json">-->

    
    <!--includes-->
    <script src="SharedTechnology/ExternalDependency/JsLibrary/moment/moment.min.js"></script>
    <script src="SharedTechnology/ExternalDependency/JsLibrary/Underscore/underscore-min.js"></script>
    <script src="SharedTechnology/ExternalDependency/JsLibrary/LinqJS/linq.min.js"></script>
    <script src="SharedTechnology/ExternalDependency/JsLibrary/JQuery/jquery-3.0.0.min.js"></script>

    <script src="SharedTechnology/ExternalDependency/JsLibrary/popper/popper.min.js"></script>
    <link rel="stylesheet" href="SharedTechnology/ExternalDependency/JsLibrary/bootstrap/css/bootstrap.min.css">
    <script src="SharedTechnology/ExternalDependency/JsLibrary/bootstrap/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="SharedTechnology/ExternalDependency/JsLibrary/Shards/css/shards.min.css">
    <script src="SharedTechnology/ExternalDependency/JsLibrary/Shards/js/shards.min.js"></script>

    <script src='https://code.responsivevoice.org/responsivevoice.js'></script>

</head>

<body>
    <!--style-->
    <style type="text/css">
        body {
            padding-top: 4rem;
        }

        .navbar{padding:5px}

        a.navbar-brand {
            font-family: 'Comic Sans MS';
            font-size:2rem;
            padding:0.1rem;
        }

        a.nav-link {
            font-size:1.5rem;
            padding:0.1rem;
             text-align: right;
        }

        .container {
            padding-left:0.2rem;
            padding-right:0.2rem;
        }

        .pagination {
            margin-top:0.2rem;
            margin-bottom:0.2rem;
        }

        .card{
            padding:0.1rem;
            margin:0.1rem;
        }

        .card-body{
            padding:0.1rem;
        }

        #home_pages button[type='button'] {
            margin-top: 0.6rem;
            margin-bottom: 0.6rem;
            margin-left: 0.3rem;
            margin-right: 0.3rem;
            padding:0.1rem;
            font-weight:bold;
            min-width: 4.2rem;
            line-height:2;
            font-size:2rem
        }

        #home_more .row {
            margin:0.5rem;
        }

        /*main .custom-control-label {
            font-size:1.6rem;
        }

        main .btn-sm {
            padding:0.1rem;
            font-size:1.2rem;
            min-width:2rem;
        }*/

        #settings_lang {
            padding: 1px;
        }

        #txtMsg {
            margin: 0.2rem;
            padding:0.5rem;
            line-height:150%;
            font-size: x-large;
        }

        .blur{
          -webkit-filter: blur(3px); /* Chrome, Safari, Opera */
          filter: blur(3px);
        }


        .sldrThin {
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
        }
    </style>

    <!--UI-->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary">
        <a class="navbar-brand" href="javascript:void(0);">Dictation</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul id="mnuMain" class="navbar-nav mr-auto">
                <li class="nav-item active"><a class="nav-link" data-page="#home" href="javascript:void(0);">Home</a></li>
                <li class="nav-item active"><a class="nav-link" data-page="#history" href="javascript:void(0);">Saved Passages</a></li>
                <li class="nav-item active"><a class="nav-link" data-page="#settings" href="javascript:void(0);">Settings</a></li>
                <li role="separator" class="dropdown-divider"></li>
                <li class="nav-item active"><a class="nav-link" data-page="#about" href="javascript:void(0);">About</a></li>
            </ul>
        </div>
    </nav>

    <main role="main" class="container">
        <div role="tabpanel" id="home" class="d-none">
            <div id="ms">
                <textarea id="txtMsg" class="form-control" rows="5" readonly>
Tyger Tyger, burning bright,
In the forests of the night;
What immortal hand or eye,
Could frame thy fearful symmetry?

魯迅說：「希望本是無所謂有，無所謂無的。這正如地上的路；其實地上本沒有路，走的人多了，也便成了路。」
</textarea>

                <nav>
                    <ul class="pagination">
                        <li class="page-item active"><a class="page-link" data-page="#home_play" href="javascript:void(0);">💬 Play</a></li>
                        <li class="page-item"><a class="page-link" data-page="#home_more" href="javascript:void(0);">More...</a></li>
                    </ul>
                </nav>

                <div id="home_pages">

                    <div id="home_play">
                        <div id="ms1">
                            <button id="home_a_next" type='button' class='btn btn-lg btn-success'>👉</button>
                            <button id="home_a_current" type='button' class='btn btn-lg btn-success'>👆</button>
                            <button id="home_b_next" type='button' class='btn btn-lg btn-info'>👉</button>
                            <button id="home_b_current" type='button' class='btn btn-lg btn-info'>👆</button>
                        </div>
                        <div>
                            <button id='home_rewind' type='button' class='btn btn-lg'>⏪</button>
                        </div>
                    </div>


                    <div id="home_more" class='d-none' style="background-color:LightSteelBlue;padding:0.2rem">

                        <div class="row">
                            <div class="custom-control custom-toggle">
                                <input type="checkbox" id="home_sym" class="custom-control-input" checked>
                                <label class="custom-control-label" for="home_sym">Read Punctuation</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="custom-control custom-toggle" style="display:inline">
                                <input type="checkbox" id="home_shield" class="custom-control-input">
                                <label class="custom-control-label" for="home_shield">🌁 Shield</label>
                            </div>
                        </div>
                        <div class="row">
                            <div>
                                <div class="col-2">
                                    Voice
                                </div>
                                <div class="col-10">
                                    <select id="settings_lang" class="form-control">
                                        <option value="UK English Female">UK English Female</option>
                                        <option value="UK English Male">UK English Male</option>
                                        <option value="US English Female">US English Female</option>
                                        <option value="Chinese Female">Chinese Female</option>
                                        <option value="Chinese (Hong Kong) Female">Chinese (Hong Kong) Female</option>
                                        <option value="Chinese Taiwan Female">Chinese Taiwan Female</option>
                                    </select>
                                </div>
                            </div>
                        </div>
   
                        <div class="row">
                            <div class="custom-control custom-toggle" style="display:inline">
                                <input type="checkbox" id="home_edit" class="custom-control-input">
                                <label class="custom-control-label" for="home_edit">✎ Edit</label>
                            </div>
                        </div>
                        <div class="row">
                            <button id='home_save' type='button' class='btn btn-sm'>💾 Save</button>
                        </div>


                    </div>
                </div>

            </div>
        </div>
        
        <div role="tabpanel" id="settings" class="d-none">
            <h3>Settings</h3>
            <div class="container">
                <label for="settings_userid">User Id</label>
                <input type="text" id="settings_userid" />

                <div class="row">
                    <div class="col">Volume</div>
                    <div class="col-10">
                        <div id="settings_volume" class="sldrThin">
                            <input type="hidden" class='custom-slider-input' name="custom-slider-value">
                        </div>

                    </div>
                </div>
            </div>
            <hr/>

            <h5>Voice A</h5>
            <div class="container">
                <div class="row">
                    <div class="col">Rate</div>
                    <div class="col-10">
                        <div id="settings_a_rate" class="sldrThin">
                            <input type="hidden" class='custom-slider-input' name="custom-slider-value">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">Pitch</div>
                    <div class="col-10">
                        <div id="settings_a_pitch" class="sldrThin">
                            <input type="hidden" class='custom-slider-input' name="custom-slider-value">
                        </div>
                    </div>
                </div>
            </div>
            <hr />

            <h5>Voice B</h5>
            <div class="container">
                <div class="row">
                    <div class="col">Rate</div>
                    <div class="col-10">
                        <div id="settings_b_rate" class="sldrThin">
                            <input type="hidden" class='custom-slider-input' name="custom-slider-value">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">Pitch</div>
                    <div class="col-10">
                        <div id="settings_b_pitch" class="sldrThin">
                            <input type="hidden" class='custom-slider-input' name="custom-slider-value">
                        </div>
                    </div>
                </div>
            </div>

            <input id="settings_save" type='button' value='Save' class='form-control' />
        </div>

        <div role="tabpanel" id="about" class="d-none">
            <h3>About</h3>
            <p>
                I have two monkeys. They are Monkey One and Monkey Two. I make this small gadget for their self study.<br />
            </p>
            <p>
                BTW, do you notice the relation between <span style="font-style:italic">Fundamental Theorem of Algebra (FTA)</span>
                and <span style="font-style:italic">Holy Roman Empire (HRE)</span>...
            </p>
            <p>
                <span style="font-style:italic">The Answer: </span> while HRE is "neither holy, nor Roman, nor an empire" (by Voltaire),
                FTA is "neither fundamental, nor a theorem, nor properly within the scope of algebra".
            </p>

        </div>

        <div role="tabpanel" id="history" class="d-none">
            <h3>Saved Passages</h3>
            <button id='history_sync' type='button' class='btn btn-lg'>sync</button>
            <div id="history_msgs"></div>
        </div>
    </main><!-- pages -->

    <!--templates -->
    <div id="tpls">
        <script type="text/template" name="tplPassage">
            <div class='card'>
                <div class='card-body'>
                    <h5 class="card-title">{{-o.createdAt}}
                        <button name="btnLoad" type="button" class="btn btn-success btn-pill btn-sm">➠</button>
                    </h5>
                    {{-o.msg}}<button name="btnDelete" type="button" class="btn btn-danger btn-pill btn-sm">✘</button>
                </div>
            </div>

        </script>
    </div>

    <!--config-->
    <script type="text/javascript">
    var MyApp = MyApp || {}; //Root object of the app

    (function (app, undefined) {
        _.templateSettings = {
            evaluate: /\{\{([\s\S]+?)\}\}/g,            // {{ console.log("blah") }}
            interpolate: /\{\{\=([\s\S]+?)\}\}/g,  // {{= title }}
            escape: /\{\{\-([\s\S]+?)\}\}/g,         // {{- title }}
            variable: "o"
        }

    })(MyApp);
    </script>

    <!--app logic-->
    <script>
        var MyApp = MyApp || {};

        (function (app, undefined) {
            var _AppLog = function (s) { console.log(s); };
            var tplFuncs = (function () {
                var ret = {};
                $('#tpls > script[type="text/template"]').each(function (i, o) {
                    ret[$(o).attr("name")] = _.template(o.innerText);
                });
                return ret;
            })();

            //----------------------------------------------------------------------------
            _AppLog("init completed");
            _AppLog("welcome");

            //Page: Home----------------------------------------------------------------------------
            var _ls = createLoacalStorage();
            var libMJ = createLibMJ();
            var appDataStore = createAppDataStore(libMJ);
            openPage("#home");

            var symsE = (function () {
                return {
                    ',': 'comma',
                    '.': 'full stop',
                    '!': 'exclamation mark',
                    '?': 'question mark',
                    '"': 'quotation mark',
                    ':': 'colon',
                    ';': 'semicolon',
                    '…': 'ellipsis'
                }
            })();

            var symsC = (function () {
                return {
                    '。': '句號',
                    '？': '問號',
                    '！': '感嘆號',
                    '，': '逗號',
                    '、': '頓號',
                    '；': '分號',
                    '：': '冒號',
                    '「': '開引號',
                    '」': '閂引號',
                    '—': '破折號',
                    '…': '省略號',
                    '。': '句號',
                    '？': '問號',
                    '！': '感嘆號',
                    '，': '逗號',
                    '、': '頓號',
                    '；': '分號',
                    '：': '冒號',
                    '「': '開引號',
                    '」': '閂引號',
                    '—': '破折號',
                    '…': '省略號'
                }
            })();

            var syms;

            $("#settings_lang").change(function () {
                var v = $("#settings_lang").val()
                if (v.indexOf("English") >= 0) {
                    syms = symsE;
                } else if (v.indexOf("Chinese") >= 0) {
                    syms = symsC;
                }
            })
            $("#settings_lang").trigger('change');

            $("#home_shield").change(function () { $("#txtMsg").toggleClass("blur"); });

            $("#home_edit").change(function () {
                document.getElementById("txtMsg").readOnly = !document.getElementById("txtMsg").readOnly;
            });

            $("#home_a_next").click(function () {
                var textComponent = document.getElementById('txtMsg');

                if (textComponent.selectionEnd < textComponent.value.length) {
                    var srch = textComponent.selectionStart = textComponent.selectionEnd;

                    while (!syms[textComponent.value[srch]] && textComponent.value[srch] != "~" && srch != textComponent.value.length - 1) { ++srch; }
                    ++srch;
                    while ((syms[textComponent.value[srch]] || textComponent.value[srch] == " ") && srch != textComponent.value.length - 1) { ++srch; }

                    textComponent.selectionEnd = srch;


                    say($("#settings_lang").val(), {
                        volume: document.getElementById("settings_volume").noUiSlider.get(),
                        rate: document.getElementById("settings_a_rate").noUiSlider.get(),
                        pitch: document.getElementById("settings_a_pitch").noUiSlider.get()
                    });
                }

                $("#txtMsg").focus();
            });

            $("#home_a_current").click(function () {
                say($("#settings_lang").val(), {
                    volume: document.getElementById("settings_volume").noUiSlider.get(),
                    rate: document.getElementById("settings_a_rate").noUiSlider.get(),
                    pitch: document.getElementById("settings_a_pitch").noUiSlider.get()
                });
            });

            $("#home_b_next").click(function () {
                var textComponent = document.getElementById('txtMsg');

                if (textComponent.selectionEnd < textComponent.value.length) {
                    var srch = textComponent.selectionStart = textComponent.selectionEnd;

                    while (!syms[textComponent.value[srch]] && textComponent.value[srch] != "~" && srch != textComponent.value.length - 1) { ++srch; }
                    ++srch;
                    while ((syms[textComponent.value[srch]] || textComponent.value[srch] == " ") && srch != textComponent.value.length - 1) { ++srch; }

                    textComponent.selectionEnd = srch;


                    say($("#settings_lang").val(), {
                        volume: document.getElementById("settings_volume").noUiSlider.get(),
                        rate: document.getElementById("settings_b_rate").noUiSlider.get(),
                        pitch: document.getElementById("settings_b_pitch").noUiSlider.get()
                    });
                }

            });

            $("#home_b_current").click(function () {
                say($("#settings_lang").val(), {
                    volume: document.getElementById("settings_volume").noUiSlider.get(),
                    rate: document.getElementById("settings_b_rate").noUiSlider.get(),
                    pitch: document.getElementById("settings_b_pitch").noUiSlider.get()
                });
            });


            $("#home_rewind").click(function () {
                var textComponent = document.getElementById('txtMsg');
                textComponent.selectionStart = 0;
                textComponent.selectionEnd = 0;
                $("#txtMsg").focus();
            }).click();

            $("#home_save").click(function () {
                var msgs = _ls.msgs.getOrCreate([]);
                msgs.push({
                    createdAt: moment().format("YYYY-MM-DD HH:mm:ss"),
                    msg: document.getElementById('txtMsg').value
                });
                _ls.msgs.set(msgs);
            });

            function say0(s, voice, voiceOpt) {
                responsiveVoice.speak(s, voice, voiceOpt);
            }

            function say(voice, voiceOpt) {
                $("#txtMsg").focus();
                var textComponent = document.getElementById('txtMsg');
                var selectedText;

                if (textComponent.selectionStart !== undefined) {
                    var startPos = textComponent.selectionStart;
                    var endPos = textComponent.selectionEnd;
                    selectedText = textComponent.value.substring(startPos, endPos);

                    if (document.getElementById("home_sym").checked) {
                        var readtext = "";
                        for (var i = 0; i < selectedText.length; ++i) {
                            readtext = readtext + (syms[selectedText[i]] ? ("  " + syms[selectedText[i]] + "  ") : selectedText[i]);
                        }
                        selectedText = readtext;
                    }

                }

                //Used to add optional volume (range 0 to 1), rate (range 0 to 1.5), pitch (range 0 to 2) 
                responsiveVoice.speak(selectedText ? selectedText : "please select some words", voice, voiceOpt);
            }

            $("#home_more .card-title").click(function () { $("#home_more .card-text").toggle(); });

            //Page: Settings----------------------------------------------------------------------------
            $("#settings_save").click(function () {
                _ls.settings.set({
                    userId: $("#settings_userid").val(),
                    volume: document.getElementById("settings_volume").noUiSlider.get(),
                    voiceA: { rate: document.getElementById("settings_a_rate").noUiSlider.get(), pitch: document.getElementById("settings_a_pitch").noUiSlider.get() },
                    voiceB: { rate: document.getElementById("settings_b_rate").noUiSlider.get(), pitch: document.getElementById("settings_b_pitch").noUiSlider.get() }
                });
                openPage("#home");
            });

            //Page: Saved Passages----------------------------------------------------------------------------
            $("#mnuMain [data-page='#history']").click(function () {
                var msgs = _ls.msgs.getOrCreate([]);

                $("#history_msgs").empty();
                msgs.forEach(function (msg, i) {
                    var joCard = $(tplFuncs["tplPassage"](msg)).appendTo("#history_msgs");

                    joCard.find("[name='btnLoad']").click(function () {
                        $("#txtMsg").val(msg.msg); openPage("#home");
                    });

                    joCard.find("[name='btnDelete']").click(function () {
                        msgs.splice(i, 1);
                        _ls.msgs.set(msgs);
                        joCard.remove();
                    });
                });
            });

            $("#history_sync").click(function () {
                appDataStore.addUser($("#settings_userid").val(), function (s) { 
                    console.log(s); 
                    appDataStore.setUserPassages($("#settings_userid").val(), _ls.msgs.getOrCreate([]));
                });
            });

            //https://api.myjson.com/bins/y1wgx----------------------------------------------------------------------------
            function createLibMJ() {
                var _ret = {};
                var cnstApi = "https://api.myjson.com/bins";

                _ret.getData = function (dataId, fSuccess) {
                    $.ajax({
                        url: cnstApi + "/" + dataId,
                        type: "GET",
                        contentType: "application/json; charset=utf-8",
                        success: function (data, textStatus, jqXHR) { fSuccess(data); },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR.responseText);
                        }
                    });
                }

                _ret.addData = function (data, fSuccess) {
                    $.ajax({
                        url: cnstApi,
                        type: "POST",
                        data: JSON.stringify(data),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            fSuccess(data.uri.replace(cnstApi + "/", ""));
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR.responseText);
                        }
                    });
                }

                _ret.updateData = function (dataId, data, fSuccess) {
                    $.ajax({
                        url: cnstApi + "/" + dataId,
                        type: "PUT",
                        data: JSON.stringify(data),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) { fSuccess(data); },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR.responseText);
                        }
                    });
                }

                /*
                //test y1wgx ci0dd
                libMJ.getData("y1wgx", function (data) {
                    console.log(data);
                });

                libMJ.addData({ "hello": "world", p: [2, 3, 5, 7] }, function (id) {
                    console.log(id);
                });

                libMJ.updateData("ci0dd", { "bar": "foo", p: [2, 3, 5, 7, 13] }, function (data) {
                    console.log(data);
                });
                */

                return _ret;
            };

            function createAppDataStore(libMJ) {
                var _libMJ = libMJ;
                var _ret = {};

                var didAppRoot = "y1wgx";

                _ret.addUser = function (userid, fMsg) {
                    fMsg = fMsg ? fMsg : function () { };
                    _libMJ.getData(didAppRoot, function (appRoot) {
                        if (appRoot.users[userid]) {
                            fMsg("user already exists");
                        } else {
                            var oUserdata = {
                                userId: userid,
                                passages: []
                            };
                            _libMJ.addData(oUserdata, function (idUserData) {
                                appRoot.users[userid] = idUserData;
                                _libMJ.updateData(didAppRoot, appRoot, function () {
                                    fMsg("user added!");
                                });
                            })
                        }
                    });
                }

                _ret.getUserPassages = function (userid, fPassages) {
                    _libMJ.getData(didAppRoot, function (appRoot) {
                        if (appRoot.users[userid]) {
                            _libMJ.getData(appRoot.users[userid], function (oUserdata) {
                                fPassages(oUserdata.passages);
                            });
                        } else {
                            fPassages([]);
                        }
                    });
                }

                _ret.setUserPassages = function (userid, passages, fMsg) {
                    fMsg = fMsg ? fMsg : function () { };
                    _libMJ.getData(didAppRoot, function (appRoot) {
                        if (appRoot.users[userid]) {
                            _libMJ.getData(appRoot.users[userid], function (oUserdata) {
                                oUserdata.passages = passages;
                                _libMJ.updateData(appRoot.users[userid], oUserdata, function () {
                                    fMsg("passages updated!");
                                });
                            });
                        } else {
                            fMsg("user does not exists");
                        }
                    });
                }

                return _ret;
            }

            //local storage----------------------------------------------------------------------------
            function createLoacalStorage() {
                function _setObj(key, obj) {
                    localStorage.setItem(key, JSON.stringify(obj));
                    return _getObj(key);
                }
                function _getObj(key) { return localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : undefined; }
                function _crLclStrgItem(key) {

                    return {
                        get: function () { return _getObj(key); },
                        set: function (obj) { return _setObj(key, obj); },
                        getOrCreate: function (obj) {
                            var _ret = _getObj(key);
                            return _ret ? _ret : _setObj(key, obj);
                        }
                    };
                }

                var ret = {
                    settings: _crLclStrgItem("settings"),
                    msgs: _crLclStrgItem("msgs")
                };

                return ret;
            }

            //BS specfic----------------------------------------------------------------------------
            function openPage(qPage) {
                $("main div[role='tabpanel']").addClass("d-none");
                $(qPage).removeClass("d-none");
            }

            $(".navbar-nav li a").click(function (event) {
                var toggle = $(".navbar-collapse").hasClass("show");
                if (toggle) {
                    $(".navbar-toggler").click();
                }
            });

            $("#mnuMain >> a").each(function () {
                $(this).on("click", function () {
                    openPage($(this).data("page"));
                });
            });

            $("#home >> nav a").each(function () {
                $(this).on("click", function () {
                    $("#home_pages > div").addClass("d-none");
                    $("#home >> nav  li").removeClass("active");
                    $($(this).data("page")).removeClass("d-none");
                    $(this).parent().addClass("active");
                });
            });

            (function guiInit() {
                var settings = _ls.settings.getOrCreate({
                    volume: 0.8,
                    voiceA: { rate: 0.5, pitch: 1.0 },
                    voiceB: { rate: 0.8, pitch: 1.0 }
                });

                if (settings.userId) {
                    $("#settings_userid").val(settings.userId);
                }

                $("#settings_volume").customSlider({
                    start: [settings.volume],
                    connect: [true, false],
                    range: { 'min': 0, 'max': 1.0 }
                });

                $("#settings_a_rate").customSlider({
                    start: [settings.voiceA.rate],
                    connect: [true, false],
                    range: { 'min': 0, 'max': 1.5 }
                });

                $("#settings_a_pitch").customSlider({
                    start: [settings.voiceA.pitch],
                    connect: [true, false],
                    range: { 'min': 0, 'max': 2.0 }
                });

                $("#settings_b_rate").customSlider({
                    start: [settings.voiceB.rate],
                    connect: [true, false],
                    range: { 'min': 0, 'max': 1.5 }
                });

                $("#settings_b_pitch").customSlider({
                    start: [settings.voiceB.pitch],
                    connect: [true, false],
                    range: { 'min': 0, 'max': 2.0 }
                });

                appDataStore.getUserPassages($("#settings_userid").val(), function (psgs) {
                    _ls.msgs.set(psgs);
                })

            })()
        })(MyApp);
    </script>

</body>
</html>
